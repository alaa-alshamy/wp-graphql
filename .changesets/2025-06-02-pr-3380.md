---
title: "perf: refactor  to lazy-load dataloaders"
pr: 3380
author: "justlevine"
type: "perf"
breaking: false
---

## What does this implement/fix? Explain your changes.

This PR refactors \`AppContext\` in the following ways:

1. Only instantiate DataLoaders when they're used instead of instantiating _all_ of them):
  - Deprecates the \`graphql_data_loaders\` filter in favor of the new \`graphql_data_loader_classes\` filter. (so you can replace the loader _before_ it's instantiated
  - Accessing \`AppContext::$loaders\` has been deprecated, in lieu of changing the property's visibility to \`protected\`/\`private\` in a future breaking release.
 
2. Updates the PHPStan typehinting for \`::get_loader()\` to correctly type-hint the loader instance for the given key.
   E.g. Previously, this would have thrown a PHPStan error that \`::get_public_users()\` doesn't exist on \`AbstractDataLoader\`
   \`\`\`php
     $users = $context->get_loader( 'user' )->get_public_users( [ ] );
     \`\`\`\`
     
This is a _nonbreaking_ change. Users still relying on \`graphql_data_loaders\` will have all their \`AppContext::$loaders\` pre-instantiated as before.

## Does this close any currently open issues?



## Any other comments?

- This PR should open the way for type hinting/inference for Connection Resolvers, deferred Models, etc.
